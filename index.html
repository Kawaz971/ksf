<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>KSF Snake ‚Äì Concours</title>
  <meta name="description" content="Mini-jeu Snake pour patienter ‚Ä¢ Concours : Ajoute & tag Instagram @KSF et tente de gagner un produit." />
  <style>
    :root{
      --ksf-yellow:#FFD400; --ksf-black:#111; --ksf-white:#fff; --ksf-mint:#00F5C8; --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; overscroll-behavior:none}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--ksf-black); background:radial-gradient(900px 480px at 10% 10%, #fff7bd 0%, #fff3a6 35%, #fff 65%); display:flex; align-items:center; justify-content:center; padding:16px; overflow:hidden; touch-action:none}
    .app{width:min(560px,100%)}
    .card{background:var(--ksf-white); border:2px solid var(--ksf-black); border-radius:var(--radius); box-shadow:0 10px 0 var(--ksf-black); overflow:hidden}
    .header{display:flex; align-items:center; gap:12px; background:var(--ksf-yellow); border-bottom:2px solid var(--ksf-black); padding:12px 14px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900}
    .brand img{width:40px;height:40px;border-radius:12px;border:2px solid var(--ksf-black);background:#fff;object-fit:cover}
    .brand .title{font-size:20px; letter-spacing:.3px}
    .badges{margin-left:auto; display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .badge{font-size:12px; padding:6px 10px; border:2px solid var(--ksf-black); border-radius:999px; background:#fff}

    .contest{display:flex; align-items:center; gap:10px; padding:10px 12px; background:#fff; border-bottom:2px dashed var(--ksf-black)}
    .contest .dot{width:10px; height:10px; border-radius:50%; background:#f33; box-shadow:0 0 0 4px rgba(243,51,51,.15)}
    .contest .text{font-size:14px; line-height:1.35}
    .contest .count{font-weight:800}

    .canvas-wrap{position:relative; background:#fef9d8}
    canvas{width:100%; aspect-ratio:1/1; display:block; image-rendering:pixelated; background:#fffdf0; border-bottom:2px solid var(--ksf-black)}

    .hud{display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px 12px; border-top:2px dashed var(--ksf-black); background:#fff}
    .scores{display:flex; gap:10px; align-items:center}
    .chip{border:2px solid var(--ksf-black); padding:6px 10px; border-radius:999px; font-weight:800; background:#fff}
    .actions{display:flex; gap:8px; flex-wrap:wrap}
    button{cursor:pointer; font-weight:800; border:2px solid var(--ksf-black); border-radius:12px; padding:10px 12px; background:#fff; transition:transform .04s ease; touch-action:manipulation}
    button:active{transform:translateY(1px)}
    .primary{background:var(--ksf-yellow)} .mint{background:var(--ksf-mint)} .ghost{background:#fff}

    .controls{display:grid; grid-template-areas: ". up ." "left down right" "replay replay replay"; grid-template-columns:1fr 1fr 1fr; gap:10px; padding:12px; background:#fff; border-top:2px dashed var(--ksf-black); justify-items:center; align-items:center}
    .controls button{width:68px;height:68px;font-size:22px}
    .controls .up{grid-area:up}
    .controls .down{grid-area:down}
    .controls .left{grid-area:left}
    .controls .right{grid-area:right}
    .controls .replay{grid-area:replay; width:200px; height:52px; font-size:16px}

    .footer{padding:10px 12px; font-size:12px; background:#fff; border-top:2px dashed var(--ksf-black); display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap}

    .overlay{position:absolute; inset:0; display:none; place-items:center; background:rgba(255,255,255,.92)}
    .overlay.active{display:grid}
    .panel{width:min(92%, 460px); background:#fff; border:2px solid var(--ksf-black); border-radius:16px; box-shadow:0 8px 0 var(--ksf-black); padding:16px}
    .panel h2{margin:.2rem 0 0.6rem}
    .panel p{margin:.5rem 0; line-height:1.4}
    .list{padding-left:18px}
    .center{display:flex; justify-content:center; gap:8px}
    .small{font-size:12px; opacity:.75}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div class="header">
        <div class="brand">
          <img id="logo" alt="Logo" />
          <div class="title" id="brandTitle">KSF ‚Äì Mini Snake</div>
        </div>
        <div class="badges">
          <div class="badge">üéÅ Top 3 = 1 produit</div>
          <div class="badge">üì∏ Montre la capture</div>
        </div>
      </div>

      <div class="contest">
        <div class="dot" style="background:#2ecc71"></div>
        <div class="text">Concours en cours ‚Ä¢ Vise le <strong>Top¬†3</strong> et montre ta capture √† la caisse üéâ</div>
      </div>
      </div>

      <div class="canvas-wrap">
        <canvas id="game" width="500" height="500"></canvas>

        <!-- Overlays -->
        <div class="overlay active" id="startOverlay">
          <div class="panel">
            <h2>üéÆ Jouer √† Snake</h2>
            <p>Jeux concour. Essaye de gagner <strong>un produit gratuit</strong> de @KSF <strong>joue aux jeux snake et partage ton score sur notre instagram</strong> apr√®s :</p>
            <ul class="list">
              <li>Avoir ajout√© Instagram <strong>@karibeanstreetfood</strong></li>
              <li>Avoir tagu√© <strong>@KSF</strong> en story</li>
            </ul>
            
            <div class="center" style="margin-top:10px">
              <button class="primary" id="btnStart">‚ñ∂Ô∏è Jouer</button>
              <button class="ghost" id="btnRules">‚ÑπÔ∏è R√®gles</button>
              <a href="https://instagram.com/karibeanstreetfood" target="_blank" rel="noopener"><button class="mint">üì≤ Instagram</button></a>
            </div>
          </div>
        </div>

        <div class="overlay" id="rulesOverlay">
          <div class="panel">
            <h2>‚ÑπÔ∏è R√®gles</h2>
            <p>Mange les fruits, √©vite les murs et ta queue. Chaque fruit = <strong>+1</strong>. La vitesse augmente au fil des points.</p>
            <ul class="list">
              <li><strong>Mobile</strong> : boutons ‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è ou balayage</li>
              <li><strong>Pause/Reprendre</strong> : bouton ‚èØÔ∏è / tape l√©ger</li>
              <li><strong>Desktop</strong> : fl√®ches ou ZQSD</li>
            </ul>
            
            <div class="center" style="margin-top:10px">
              <button class="primary" id="btnBack">OK</button>
            </div>
          </div>
        </div>

        <div class="overlay" id="gameOverOverlay">
          <div class="panel">
            <h2>üí• Perdu !</h2>
            <p id="finalScore">Score : 0</p>
            <p id="bestScore">Meilleur : 0</p>
            <p id="contestNote" class="small">Prends une <strong>capture</strong> et partage sur ton insta "Tirage au sort en fin de journ√©e" üì∏</p>
            <div class="center" style="margin-top:10px">
              <button class="primary" id="btnRestart">‚Üª Rejouer</button>
              <button class="mint" id="btnShare">Partager</button>
              <a href="https://instagram.com/karibeanstreetfood" target="_blank" rel="noopener"><button class="ghost">üì≤ Ouvrir Instagram</button></a>
            </div>
          </div>
        </div>
      </div>

      <div class="hud">
        <div class="scores">
          <div class="chip">Score: <span id="score">0</span></div>
          <div class="chip">Best: <span id="hi">0</span></div>
        </div>
        <div class="actions">
          <button id="btnPause">‚èØÔ∏è Pause</button>
          <button id="btnHow">‚ÑπÔ∏è</button>
        </div>
      </div>

      <div class="controls" id="controls">
        <button type="button" class="up" data-dir="up">‚¨ÜÔ∏è</button>
        <button type="button" class="down" data-dir="down">‚¨áÔ∏è</button>
        <button type="button" class="left" data-dir="left">‚¨ÖÔ∏è</button>
        <button type="button" class="right" data-dir="right">‚û°Ô∏è</button>
        <button type="button" class="replay" id="btnReplay">‚èØÔ∏è Start / Rejouer</button>
      </div>

      <div class="footer">
        <div>Insta : <strong>@KSF</strong> ‚Ä¢ <strong>@Sowbella_France</strong></div>
        <div class="small">HTML5 offline-ready ‚Ä¢ Pense √† faire une capture üì∏</div>
      </div>
    </div>
  </div>

  <script>
    // ===== Config =====
    const CONFIG = {
      brandTitle: 'KSF ‚Äì Mini Snake',
      logoUrl: '', // URL PNG si dispo
      grid: 20,
      speedStartMs: 140,
      speedMinMs: 70,
      speedStepScore: 4,
      hiStorageKey: 'ksfSnakeHighScore', // 20:00 local time
      theme: { snake:'#111', head:'#000', fruit:'#ff3b3b', board:'#fffdf0', grid:'#f3e9a2' }
    };

    // ===== Branding =====
    document.getElementById('brandTitle').textContent = CONFIG.brandTitle;
    const logo = document.getElementById('logo');
    if(CONFIG.logoUrl){ logo.src = CONFIG.logoUrl; logo.style.display='block'; }
    else{
      const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect width='64' height='64' rx='12' fill='%23FFD400' stroke='%23111' stroke-width='4'/><text x='50%' y='56%' text-anchor='middle' font-weight='900' font-size='28' fill='%23111' font-family='Arial, Helvetica, sans-serif'>KSF</text></svg>`);
      logo.src = `data:image/svg+xml;charset=utf-8,${svg}`; logo.style.display='block';
    }

    // ===== Anti scroll / refresh mobile =====
    document.addEventListener('touchmove', (e)=>{ if(e.touches.length===1){ e.preventDefault(); } }, {passive:false});

    // ===== Game state =====
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let cell; const world = { size: CONFIG.grid };
    let snake, dir, nextDir, fruit, score, best, timer, speed;

    const scoreEl = document.getElementById('score');
    const hiEl = document.getElementById('hi');
    const startOverlay = document.getElementById('startOverlay');
    const rulesOverlay = document.getElementById('rulesOverlay');
    const gameOverOverlay = document.getElementById('gameOverOverlay');

    const btnStart = document.getElementById('btnStart');
    const btnRules = document.getElementById('btnRules');
    const btnBack = document.getElementById('btnBack');
    const btnRestart = document.getElementById('btnRestart');
    const btnShare = document.getElementById('btnShare');
    const btnPause = document.getElementById('btnPause');
    const btnHow = document.getElementById('btnHow');
    const btnReplay = document.getElementById('btnReplay');

    function haptic(ms=20){ if('vibrate' in navigator){ navigator.vibrate(ms); } }

    function loadBest(){ const v = parseInt(localStorage.getItem(CONFIG.hiStorageKey)||'0',10); best = isNaN(v)?0:v; hiEl.textContent = best; }
    function saveBest(){ localStorage.setItem(CONFIG.hiStorageKey, String(best)); }

    function reset(){
      snake = [ {x:10,y:10}, {x:9,y:10}, {x:8,y:10} ];
      dir = {x:1,y:0}; nextDir = {x:1,y:0};
      score = 0; scoreEl.textContent = score; speed = CONFIG.speedStartMs;
      spawnFruit(); draw();
    }

    function spawnFruit(){
      do{ fruit = { x: Math.floor(Math.random()*world.size), y: Math.floor(Math.random()*world.size) }; }
      while(snake.some(s=>s.x===fruit.x && s.y===fruit.y));
    }

    function drawCell(x,y,color){ ctx.fillStyle = color; ctx.fillRect(x*cell, y*cell, cell, cell); }
    function drawGrid(){ ctx.strokeStyle = CONFIG.theme.grid; ctx.lineWidth = 1; for(let i=0;i<=world.size;i++){ ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell, world.size*cell); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(world.size*cell, i*cell); ctx.stroke(); } }

    function draw(){ ctx.fillStyle = CONFIG.theme.board; ctx.fillRect(0,0,canvas.width, canvas.height); drawGrid(); drawCell(fruit.x, fruit.y, CONFIG.theme.fruit); snake.forEach((s,i)=> drawCell(s.x,s.y, i===0?CONFIG.theme.head:CONFIG.theme.snake)); }

    function tick(){
      if((nextDir.x !== -dir.x) || (nextDir.y !== -dir.y)) dir = nextDir;
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
      if(head.x<0 || head.y<0 || head.x>=world.size || head.y>=world.size || snake.some(s=>s.x===head.x && s.y===head.y)) return gameOver();
      snake.unshift(head);
      if(head.x===fruit.x && head.y===fruit.y){
        score++; scoreEl.textContent = score; if(score>best){ best=score; hiEl.textContent=best; saveBest(); }
        if(score % CONFIG.speedStepScore === 0){ speed = Math.max(CONFIG.speedMinMs, speed-10); clearInterval(timer); timer = setInterval(tick, speed); }
        spawnFruit();
      } else { snake.pop(); }
      draw();
    }

    function play(){ clearInterval(timer); timer = setInterval(tick, speed); }
    function pause(){ clearInterval(timer); timer=null; }
    function togglePause(){ if(timer){ pause(); } else { play(); } btnPause.textContent = timer? '‚èØÔ∏è Pause' : '‚ñ∂Ô∏è Reprendre'; }
    function gameOver(){ pause(); document.getElementById('finalScore').textContent = 'Score : '+score; document.getElementById('bestScore').textContent = 'Meilleur : '+best; gameOverOverlay.classList.add('active'); }

    // ===== Inputs clavier =====
    const keyMap = { ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0}, KeyW:{x:0,y:-1}, KeyS:{x:0,y:1}, KeyA:{x:-1,y:0}, KeyD:{x:1,y:0} };
    window.addEventListener('keydown', (e)=>{ const nd = keyMap[e.code]; if(nd){ e.preventDefault(); nextDir = nd; haptic(10);} if(e.code==='Space'){ e.preventDefault(); togglePause(); }});

    // ===== Gestes tactiles (balayage + tape) =====
    let touchStart = null; const SWIPE_THRESHOLD = 18;
    function handleSwipe(dx, dy){ if(Math.abs(dx) < SWIPE_THRESHOLD && Math.abs(dy) < SWIPE_THRESHOLD){ togglePause(); return; } if(Math.abs(dx) > Math.abs(dy)) nextDir = dx>0 ? {x:1,y:0} : {x:-1,y:0}; else nextDir = dy>0 ? {x:0,y:1} : {x:0,y:-1}; haptic(10); }
    function onPointerDown(ev){ const t = ev.touches ? ev.touches[0] : ev; touchStart = {x:t.clientX, y:t.clientY}; }
    function onPointerUp(ev){ if(!touchStart) return; const t = ev.changedTouches ? ev.changedTouches[0] : ev; const dx = t.clientX - touchStart.x; const dy = t.clientY - touchStart.y; touchStart = null; handleSwipe(dx, dy); }
    canvas.addEventListener('pointerdown', onPointerDown, {passive:true});
    canvas.addEventListener('pointerup', onPointerUp, {passive:true});
    canvas.addEventListener('touchstart', onPointerDown, {passive:true});
    canvas.addEventListener('touchend', onPointerUp, {passive:true});

    // ===== Boutons √† l'√©cran =====
    const dirMap = {up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}};
    const controls = document.getElementById('controls');
    // Bloque toute action par d√©faut sur cette zone (anti refresh sur Android)
    ['touchstart','touchend','mousedown','click'].forEach(evt=>{
      controls.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); }, {passive:false});
    });
    controls.querySelectorAll('[data-dir]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ nextDir = dirMap[btn.dataset.dir]; haptic(10); });
      btn.addEventListener('touchend', ()=>{ nextDir = dirMap[btn.dataset.dir]; haptic(10); }, {passive:true});
    });
    document.getElementById('btnReplay').addEventListener('click', ()=>{ if(startOverlay.classList.contains('active')) startOverlay.classList.remove('active'); if(gameOverOverlay.classList.contains('active')) gameOverOverlay.classList.remove('active'); reset(); play(); btnPause.textContent = '‚èØÔ∏è Pause'; });

    // ===== Buttons =====
    btnStart.addEventListener('click', ()=>{ startOverlay.classList.remove('active'); reset(); play(); btnPause.textContent='‚èØÔ∏è Pause'; });
    btnRules.addEventListener('click', ()=>{ startOverlay.classList.remove('active'); rulesOverlay.classList.add('active'); });
    btnBack.addEventListener('click', ()=>{ rulesOverlay.classList.remove('active'); startOverlay.classList.add('active'); });
    btnRestart.addEventListener('click', ()=>{ gameOverOverlay.classList.remove('active'); reset(); play(); btnPause.textContent='‚èØÔ∏è Pause'; });
    btnShare.addEventListener('click', async ()=>{ const text = `J'ai fait ${score} points au Snake KSF ! @KSF @Sowbella_France`; try{ if(navigator.share){ await navigator.share({text, title:'KSF Snake', url: location.href}); } else { await navigator.clipboard.writeText(text); alert('Score copi√© ! Colle-le dans ta story Insta üì≤'); } }catch(err){} });
    btnPause.addEventListener('click', togglePause);
    btnHow.addEventListener('click', ()=> rulesOverlay.classList.add('active'));

    // ===== Responsive =====
    function resizeCanvas(){ const w = document.querySelector('.canvas-wrap').clientWidth; const size = Math.round(w); canvas.width = size; canvas.height = size; cell = Math.floor(size / CONFIG.grid); if(snake) draw(); }
    window.addEventListener('resize', resizeCanvas);

    // ===== Init =====
    function init(){ loadBest(); resizeCanvas(); }
    init();
  </script>
</body>
</html>
